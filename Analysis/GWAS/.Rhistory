rm(list=ls())
library(NAM)
library(ggplot2)
library(dplyr)
gen_raw <- read.table("~/Dropbox/SmithLab/NAM/Analysis/WholeNAM_80mis_6060ind/Imputed_Output/Filtered_maf_mis_LD/Final_filt_LDKNNI_noMis_noNAHHras_rasBased_MAF5_noLD.txt", header = T)
dim(gen_raw)
gen_raw[1:10,1:3]
gen_rawX <- read.table("~/Dropbox/SmithLab/NAM/Analysis/WholeNAM_80mis_6060ind/Imputed_Output/Filtered_maf_mis_LD/Final_filt_Fillin_noMis_noNAHHras_rasBased_MAF5_noLD.txt", header = T)
dim(gen_rawX)
gen_raw_t <- t(gen_raw)
write.csv(gen_raw_t, "~/Dropbox/SmithLab/NAM/Analysis/WholeNAM_80mis_6060ind/Imputed_Output/Filtered_maf_mis_LD/GWAS/Genotypes/Final_filt_LDKNNI_noMis_noNAHHras_rasBased_MAF5_noLD_t.csv")
y <- read.csv("~/Dropbox/GITHUB/BRIDG6/Datasets/Phenotypes/DAP_BLUPs_nob_no2_no19.csv", header=T)
gen <- read.csv("~/Dropbox/SmithLab/NAM/Analysis/WholeNAM_80mis_6060ind/Imputed_Output/Filtered_maf_mis_LD/GWAS/Genotypes/Final_filt_LDKNNI_noMis_noNAHHras_rasBased_MAF5_noLD_t.csv", header = T)
class(y)
class(gen)
dim(y)
dim(gen)
gen_noRas <- gen[-1,]
gen_1<-gen_noRas[(gen_noRas[,1] %in% y[,1] ),]
gen_2 <- gen_1[rowSums(is.na(gen_1)) != ncol(gen_1),]
print (paste("There were", dim(gen_1)[1] - dim(gen_2)[1], "samples with all SNPs missing", sep=" "))
y_1 <- y[match(gen_2$X, y$line_name, nomatch = NA, incomparables = F),]
y_2 <- y_1[rowSums(is.na(y_1)) != ncol(y_1),]
gen_2_or<-gen_2[match(y_2[,1] , gen_2[,1]),]
if (identical(as.character(gen_2_or[,1]), as.character(y_2[,1])) == FALSE) stop("Phenotypes and Genotypes samples do not match")
gen_naked <- select(gen_2_or, -(X))
adjusted_genotypes = snpQC( gen=gen_naked, MAF=0.05, impute=FALSE)
rownames(adjusted_genotypes) = y_2$line_name
dim(adjusted_genotypes)
na_count <-sapply(adjusted_genotypes, function(y) sum(length(which(is.na(y)))))
na_count <- data.frame(na_count)
na_count$name<-rownames(na_count)
het_count <-sapply(adjusted_genotypes, function(y) sum(length(which(y == 1))))
het_count <- data.frame(het_count)
het_count$name<-rownames(het_count)
alt_count <-sapply(adjusted_genotypes, function(y) sum(length(which(y == 0))))
alt_count <- data.frame(alt_count)
alt_count$name<-rownames(alt_count)
Ras_count <-sapply(adjusted_genotypes, function(y) sum(length(which(y == 2))))
Ras_count <- data.frame(Ras_count)
Ras_count$name<-rownames(Ras_count)
geno_freq <- cbind(alt_count, het_count,Ras_count )
geno_frequency <- geno_freq[,-c(2,4,6)]
geno_frequency$name<-rownames(geno_freq)
library(reshape2)
melted_freq <- melt(geno_frequency, id.vars = "name")
ggplot(melted_freq, aes(value, fill = factor(variable))) +
labs(x = "Number of Observations in the BRIDG6", y = "Number of Markers") +
scale_fill_manual(name="Genotype",values= c("Blue", "yellow", "red"), labels = c( "Donor Parent", "Heterozygous","Rasmusson")) +
geom_histogram(bins = 50, alpha = 0.6)
ggplot(Ras_count, aes(Ras_count)) +
geom_histogram(bins = 50)
ggplot(alt_count, aes(alt_count)) +
geom_histogram(bins = 50)
chr = data.frame(table(gsub("._.+$", "",colnames(adjusted_genotypes))))[,2]
write.csv(adjusted_genotypes, "~/Dropbox/SmithLab/NAM/Analysis/WholeNAM_80mis_6060ind/Imputed_Output/Filtered_maf_mis_LD/GWAS/forGWAS/genos_LDKNNI.csv")
write.csv(y_2, "~/Dropbox/SmithLab/NAM/Analysis/WholeNAM_80mis_6060ind/Imputed_Output/Filtered_maf_mis_LD/GWAS/forGWAS/phenos_LDKNNI.csv")
